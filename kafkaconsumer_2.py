import jsonimport requestsfrom kafka import KafkaConsumerimport timeimport numpy as npimport datetimedef get_token():	domain = "arquisoft201720-egalvis10.auth0.com"	api_identifier = "uniandes.edu.co/thermalcomfort"	client_id = "kpFoygxMnq0vRHhF8xEBl4m9wbDe5jQy"	client_secret = "Fa1d5fJXpstG9jhNzDhG1yvZVmJmAyLeBYWI46JzKdi7fMKKpFFnb-2cEVuV2iX7"	grant_type = "client_credentials"	base_url = "https://{domain}".format(domain=domain) + "/oauth/token"	payload = {		'client_id': client_id,		'client_secret': client_secret,		'audience': api_identifier,		'grant_type': grant_type	}	response = requests.post(base_url, data=json.dumps(payload), headers={'Content-type': 'application/json'})	auth0_response = response.json()	token_auth0 = auth0_response.get('access_token')	return token_auth0def enviarDatos(consum):	temperatura = []	co2 = []	luz = []	sonido = [] 	min_temp = 1000000000000	max_temp = 0	min_co2  = 1000000000000	max_c02  = 0	min_luz  = 1000000000000	max_luz  = 0	min_son  = 1000000000000	max_son  = 0 	start_time = time.time()	for message in consum:		json_data = json.loads(message.value.decode('utf-8'))		elapsed_time = time.time() - start_time		if round(elapsed_time)%60 ==0:					prom_temp = np.mean(temperatura)			prom_luz  = np.mean(luz)			prom_son  = np.mean(sonido)			prom_c2   = np.mean(co2)						if prom_temp >  max_temp:				max_temp = prom_temp			if prom_temp < min_temp:				min_temp = prom_temp							if prom_luz >  max_luz:				max_luz = prom_luz			if prom_luz < min_luz:				min_luz = prom_luz							if  prom_son >  max_son:				max_son = prom_son			if prom_son < min_son:				min_son = prom_son							if prom_c2 >  max_c02:				max_c02 = prom_c2			if prom_c2 < min_co2:				min_co2 = prom_c2							sensetime = json_data['sensetime']			print(datetime.datetime.now())			print (prom_c2)			print(min_co2)			print(max_c02)			##url = 'http://172.24.42.59:8080/sensors/piso1.local1/realtimedata'			url = 'http://localhost:8080/sensors/piso1.local1/realtimedata'			#print(sense)			tok = get_token()			jason_date = str(datetime.datetime.now())			payload = {'samplingTime': sensetime,'promTemp':prom_temp,'promCo2':prom_c2,'promSon':prom_son,'promLuz':prom_luz,'idSensor':'1'}			response = requests.post(url, data=json.dumps(payload), headers={'Content-type': 'application/json','Authorization': 'Bearer ' +tok})			print("Response Status Code: " + str(response.status_code))						temperatura = []			co2 = []			luz = []			sonido = [] 		if len(json_data)>1:			sensetime = json_data['sensetime']			sense = json_data['data']			location = message.topic.split('.')			sensor_code = location[1] + '.' + location[2]			#Obtiene los datos del json			temp = sense['temperature']			co2_ = sense['CO2']			sou = sense['sound']			luzz = sense['light']						#Agrega a lista de cada cosa			temperatura.append(temp)			co2.append(co2_)			luz.append(luzz)			sonido.append(sou)										try: 		consumer = KafkaConsumer('alta.piso1.local1',group_id='temperature', bootstrap_servers=['localhost:8090'])	enviarDatos(consumer)except:		print('pipeline 1 no disponible')		try: 				consumer = KafkaConsumer('alta.piso1.local1',group_id='temperature', bootstrap_servers=['172.24.42.59:8090'])			enviarDatos(consumer)		except:			print('pipeline 2 no disponible')			try: 					consumer = KafkaConsumer('alta.piso1.local1',group_id='temperature', bootstrap_servers=['172.24.42.61:8090'])				enviarDatos(consumer)			except:				print('pipeline 3 no disponible')				try: 						consumer = KafkaConsumer('alta.piso1.local1',group_id='temperature', bootstrap_servers=['172.24.42.60:8090'])					enviarDatos(consumer)				except:					print('pipeline 4 no disponible')					print('No hay ningun pipeline disponible') #print(consumer) #print('$#$$$$$$$$$$')#print(consumer.poll is None)#enviarDatos(consumer) 